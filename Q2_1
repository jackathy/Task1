mysql -u root -p --local_infile=1
use test2
CREATE TABLE table_2 (
    id INT NOT NULL,
    `year` INT NOT NULL,
    `month` INT NOT NULL,
    `hour` INT NOT NULL,
    pm2 INT NOT NULL,
    DEWP INT NOT NULL,
    TEMP INT NOT NULL,
    PRES INT NOT NULL,
    cwbd VARCHAR(2) NOT NULL,
    Iws INT NOT NULL,
    `Is` INT NOT NULL,
    Ir INT NOT NULL,
    ) ENGINE=INNODB;
	
LOAD DATA LOCAL INFILE 'data2.csv' INTO TABLE table_2 FIELDS TERMINATED BY ',' ENCLOSED BY '"' IGNORE 1 ROWS;


ALTER TABLE table_2 ADD stdpm FLOAT;
ALTER TABLE table_2 ADD meanpm FLOAT;
UPDATE table_2 SET stdpm = (SELECT STDDEV(pm2) 
     FROM table_2 
     WHERE id < a.id
     AND id >= a.id - 3
	 AND pm2 IS NOT NULL
     ) FROM table_2 a;

UPDATE table_2 SET meanpm = (SELECT AVG(pm2) 
     FROM table_2 
     WHERE id < a.id
     AND id >= a.id - 3
	 AND pm2 IS NOT NULL
     ) FROM table_2 a;

SELECT * FROM table_2 WHERE pm2 > meanpm + 3 * stdpm AND pm2 IS NOT NULL ;
